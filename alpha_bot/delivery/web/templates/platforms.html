{% extends "base.html" %}
{% block title %}Platform Intel — Alpha Bot{% endblock %}
{% block content %}
<h2>Platform Intelligence</h2>

<!-- Stats Grid -->
<div class="stats-grid">
    {% for s in stats %}
    <div class="stat-box">
        <div class="value">{{ s.total }}</div>
        <div class="label">{{ s.platform | title }} Tokens</div>
    </div>
    <div class="stat-box">
        <div class="value">{{ "%.0f" | format(s.survival_pct) }}%</div>
        <div class="label">{{ s.platform | title }} Survival</div>
    </div>
    <div class="stat-box">
        <div class="value">${{ "%.0f" | format(s.avg_peak_mcap / 1000) }}K</div>
        <div class="label">{{ s.platform | title }} Avg Peak</div>
    </div>
    {% endfor %}
    {% if not stats %}
    <div class="stat-box">
        <div class="value">0</div>
        <div class="label">Tracked Tokens</div>
    </div>
    {% endif %}
</div>

<!-- Filter Tabs -->
<div style="margin: 1.5rem 0 1rem; display: flex; gap: 0.5rem;">
    <a href="/platforms"
       class="filter-tab {% if not platform_filter %}active{% endif %}">All</a>
    <a href="/platforms?platform=clanker"
       class="filter-tab {% if platform_filter == 'clanker' %}active{% endif %}">Clanker</a>
    <a href="/platforms?platform=virtuals"
       class="filter-tab {% if platform_filter == 'virtuals' %}active{% endif %}">Virtuals</a>
    <a href="/platforms?platform=flaunch"
       class="filter-tab {% if platform_filter == 'flaunch' %}active{% endif %}">Flaunch</a>
</div>

<style>
    .filter-tab {
        color: #8b949e;
        text-decoration: none;
        padding: 0.4rem 1rem;
        border-radius: 6px;
        border: 1px solid #30363d;
        font-size: 0.9rem;
        transition: all 0.2s;
    }
    .filter-tab:hover { color: #c9d1d9; border-color: #58a6ff; }
    .filter-tab.active { color: #fff; background: #238636; border-color: #238636; }
    .platform-badge {
        display: inline-block;
        padding: 0.15rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    .platform-badge.clanker { background: #1e3a5f; color: #58a6ff; }
    .platform-badge.virtuals { background: #3b1f4e; color: #c084fc; }
    .platform-badge.flaunch { background: #1f3d1f; color: #3fb950; }
    table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    th {
        text-align: left;
        padding: 0.6rem 0.8rem;
        border-bottom: 2px solid #30363d;
        color: #8b949e;
        font-size: 0.8rem;
        text-transform: uppercase;
    }
    td {
        padding: 0.6rem 0.8rem;
        border-bottom: 1px solid #21262d;
        font-size: 0.9rem;
    }
    tr:hover { background: #161b22; }
    .mono { font-family: monospace; font-size: 0.8rem; color: #8b949e; }
</style>

<!-- Token Table -->
<div class="section-card" style="overflow-x: auto;">
    <table>
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Platform</th>
                <th>Age</th>
                <th>Holders</th>
                <th>Peak MCap</th>
                <th>Current MCap</th>
                <th>7d</th>
                <th>$100K</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for t in tokens %}
            <tr>
                <td><b>{{ t.symbol or '?' }}</b></td>
                <td><span class="platform-badge {{ t.platform }}">{{ t.platform }}</span></td>
                <td>{{ t._age_str }}</td>
                <td>{{ t._holders_str }}</td>
                <td>{{ t._peak_mcap_str }}</td>
                <td>{{ t._current_mcap_str }}</td>
                <td>{{ "✅" if t.survived_7d else "❌" }}</td>
                <td>{{ "✅" if t.reached_100k else "❌" }}</td>
                <td>{{ t.check_status }}</td>
            </tr>
            {% endfor %}
            {% if not tokens %}
            <tr>
                <td colspan="9" style="text-align: center; color: #8b949e; padding: 2rem;">
                    No platform tokens tracked yet.<br>
                    Enable the Clanker scraper with <code>CLANKER_SCRAPER_ENABLED=true</code>.
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}
